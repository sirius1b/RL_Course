import numpy as np
import math



def value_iteration(states, actions, nextSR, gamma, threshold=1e-8):
	V = np.random.random((len(states)))
	while 1:
		delta = 0
		for state in states:
			v = V[states.index(state)]
			acts, pi = actions[state]
			max_vs = -np.inf
			for act in acts:
				SR, pSR = nextSR[(state,act)]
				vs = 0
				for sr in SR:
					vs += pSR[SR.index(sr)]*(sr[1]+gamma*V[states.index(sr[0])])
				max_vs = max(max_vs,vs)
			V[states.index(state)] = max_vs
			delta = max(delta,np.abs(v - V[states.index(state)]))
		print(delta)
		if delta < threshold:
			break
	print(V.reshape(5,5)) #output

	# policy determination
	action_name = {'a1': 'U',
					'a2': "L",
					'a3':'D',
					'a4':'R'}
	policy = {}
	policy1 = np.arange(25).astype('object') # output
	for state in states :
		acts, pi = actions[state]
		max_vs = -np.inf
		b_act = ""
		for act in acts:
			SR, pSR = nextSR[(state,act)]
			vs = 0
			for sr in SR:
				vs += pSR[SR.index(sr)]*(sr[1]+gamma*V[states.index(sr[0])])
			
			if max_vs < vs :
				max_vs = vs
				b_act = act
		policy[state] = b_act
		policy1[states.index(state)]=(action_name[b_act])
	print(policy1.reshape((5,5))) #output
	print(policy) #output







states = [	's1',
			's2',
			's3',
			's4',
			's5',
			's6',
			's7',
			's8',
			's9',
			's10',
			's11',
			's12',
			's13',
			's14',
			's15',
			's16',
			's17',
			's18',
			's19',
			's20',
			's21',
			's22',
			's23',
			's24',
			's25']

actions = { 's1':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's2':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's3':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's1':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's4':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's5':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's6':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's7':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's8':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's9':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's10':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's11':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's12':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's13':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's14':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's15':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's16':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's17':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's18':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's19':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's20':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's21':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's22':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's23':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's24':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]],
			's25':[['a1','a2','a3','a4'],[0.25,0.25,0.25,0.25]]}


nextSR = { 	('s1','a1'):[[('s1',-1)],[1]],
			('s1','a2'):[[('s1',-1)],[1]],
			('s1','a3'):[[('s6',0)],[1]],
			('s1','a4'):[[('s2',0)],[1]],

			('s2','a1'):[[('s22',10)],[1]],
			('s2','a2'):[[('s22',10)],[1]],
			('s2','a3'):[[('s22',10)],[1]],
			('s2','a4'):[[('s22',10)],[1]],

			('s3','a1'):[[('s3',-1)],[1]],
			('s3','a2'):[[('s2',0)],[1]],
			('s3','a3'):[[('s8',0)],[1]],
			('s3','a4'):[[('s4',0)],[1]],

			('s4','a1'):[[('s14',5)],[1]],
			('s4','a2'):[[('s14',5)],[1]],
			('s4','a3'):[[('s14',5)],[1]],
			('s4','a4'):[[('s14',5)],[1]],

			('s5','a1'):[[('s5',-1)],[1]],
			('s5','a2'):[[('s4',0)],[1]],
			('s5','a3'):[[('s10',0)],[1]],
			('s5','a4'):[[('s5',-1)],[1]],

			('s6','a1'):[[('s1',0)],[1]],
			('s6','a2'):[[('s6',-1)],[1]],
			('s6','a3'):[[('s11',0)],[1]],
			('s6','a4'):[[('s7',0)],[1]],

			('s7','a1'):[[('s2',0)],[1]],
			('s7','a2'):[[('s6',0)],[1]],
			('s7','a3'):[[('s12',0)],[1]],
			('s7','a4'):[[('s8',0)],[1]],

			('s8','a1'):[[('s3',0)],[1]],
			('s8','a2'):[[('s7',0)],[1]],
			('s8','a3'):[[('s13',0)],[1]],
			('s8','a4'):[[('s9',0)],[1]],

			('s9','a1'):[[('s4',0)],[1]],
			('s9','a2'):[[('s8',0)],[1]],
			('s9','a3'):[[('s14',0)],[1]],
			('s9','a4'):[[('s10',0)],[1]],

			('s10','a1'):[[('s5',0)],[1]],
			('s10','a2'):[[('s9',0)],[1]],
			('s10','a3'):[[('s15',0)],[1]],
			('s10','a4'):[[('s10',0)],[1]],

			('s11','a1'):[[('s6',0)],[1]],
			('s11','a2'):[[('s11',-1)],[1]],
			('s11','a3'):[[('s16',0)],[1]],
			('s11','a4'):[[('s12',0)],[1]],

			('s12','a1'):[[('s7',0)],[1]],
			('s12','a2'):[[('s11',0)],[1]],
			('s12','a3'):[[('s17',0)],[1]],
			('s12','a4'):[[('s13',0)],[1]],

			('s13','a1'):[[('s8',0)],[1]],
			('s13','a2'):[[('s12',0)],[1]],
			('s13','a3'):[[('s18',0)],[1]],
			('s13','a4'):[[('s14',0)],[1]],

			('s14','a1'):[[('s9',0)],[1]],
			('s14','a2'):[[('s13',0)],[1]],
			('s14','a3'):[[('s19',0)],[1]],
			('s14','a4'):[[('s15',0)],[1]],

			('s15','a1'):[[('s10',0)],[1]],
			('s15','a2'):[[('s14',0)],[1]],
			('s15','a3'):[[('s20',0)],[1]],
			('s15','a4'):[[('s15',-1)],[1]],
			
			('s16','a1'):[[('s11',0)],[1]],
			('s16','a2'):[[('s16',-1)],[1]],
			('s16','a3'):[[('s21',0)],[1]],
			('s16','a4'):[[('s17',0)],[1]],

			('s17','a1'):[[('s12',0)],[1]],
			('s17','a2'):[[('s16',0)],[1]],
			('s17','a3'):[[('s22',0)],[1]],
			('s17','a4'):[[('s18',0)],[1]],

			('s18','a1'):[[('s13',0)],[1]],
			('s18','a2'):[[('s17',0)],[1]],
			('s18','a3'):[[('s23',0)],[1]],
			('s18','a4'):[[('s19',0)],[1]],

			('s19','a1'):[[('s14',0)],[1]],
			('s19','a2'):[[('s18',0)],[1]],
			('s19','a3'):[[('s24',0)],[1]],
			('s19','a4'):[[('s20',0)],[1]],

			('s20','a1'):[[('s15',0)],[1]],
			('s20','a2'):[[('s19',0)],[1]],
			('s20','a3'):[[('s25',0)],[1]],
			('s20','a4'):[[('s20',-1)],[1]],
			
			('s21','a1'):[[('s16',0)],[1]],
			('s21','a2'):[[('s21',-1)],[1]],
			('s21','a3'):[[('s21',-1)],[1]],
			('s21','a4'):[[('s22',0)],[1]],

			('s22','a1'):[[('s17',0)],[1]],
			('s22','a2'):[[('s21',0)],[1]],
			('s22','a3'):[[('s22',-1)],[1]],
			('s22','a4'):[[('s23',0)],[1]],

			('s23','a1'):[[('s18',0)],[1]],
			('s23','a2'):[[('s22',0)],[1]],
			('s23','a3'):[[('s23',-1)],[1]],
			('s23','a4'):[[('s24',0)],[1]],

			('s24','a1'):[[('s19',0)],[1]],
			('s24','a2'):[[('s23',0)],[1]],
			('s24','a3'):[[('s24',-1)],[1]],
			('s24','a4'):[[('s25',0)],[1]],

			('s25','a1'):[[('s20',0)],[1]],
			('s25','a2'):[[('s24',0)],[1]],
			('s25','a3'):[[('s25',-1)],[1]],
			('s25','a4'):[[('s25',-1)],[1]],


			}

value_iteration(states, actions, nextSR, gamma = 0.9)